name: deploy

on:
  push:
    branches: [main] # 这里是你当前主分支的名字
    paths-ignore:
      - README.md ## 表示该文件更新不会触发部署

jobs:
  Build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3   
      with:
        node-version: '16.x'

    # 配置依赖缓存
    - name: Yarn cache
      id: yarn-cache-dir-path
      run: echo "::set-output name=dir::$(yarn cache dir)"
      
    - uses: actions/cache@v2
      id: yarn-cache
      with: 
        path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
        key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
        restore-keys: | 
          ${{ runner.os }}-yarn-

    - run: yarn install && yarn build

    - name: Generate RSS
      run: |
        # 在这里根据你的项目需求生成 RSS 文件
        echo "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>" > build/rss.xml
        echo "<rss version=\"2.0\">" >> build/rss.xml
        echo "  <channel>" >> build/rss.xml
        echo "    <title>Your Blog Title</title>" >> build/rss.xml
        echo "    <link>https://yourwebsite.com</link>" >> build/rss.xml
        echo "    <description>A brief description of your blog</description>" >> build/rss.xml
        echo "    <language>zh-cn</language>" >> build/rss.xml
        echo "    <pubDate>$(date -u +"%a, %d %b %Y %H:%M:%S +0000")</pubDate>" >> build/rss.xml
        # 可以在这里添加更多 <item> 的生成逻辑
        echo "  </channel>" >> build/rss.xml
        echo "</rss>" >> build/rss.xml

    - name: Deploy
      uses: JamesIves/github-pages-deploy-action@v4.2.3
      with:
        branch: gh-pages 
        folder: build   # build后文件目录
